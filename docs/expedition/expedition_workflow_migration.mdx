---
id: expedition_workflow_migration
title: Migration Workflow
sidebar_label: Configuration Migration
hide_title: false
description: Migration Workflow
keywords:
  - pan-os
  - panos
  - xml
  - api
  - expedition
  - migration
  - firewall
  - configuration
  - automation
  - migration
  - convertion

image: /img/expedition.png
---  
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Link from "@docusaurus/Link"; 
export function SetLanguage (lang) {
  if (typeof window !== 'undefined'){
    localStorage.setItem('defaultLanguage', lang)
    window.location.reload()
  }
}  



**Choose language for code snippet**

<a className="button button--primary" onClick={() => SetLanguage('python')}>Python</a>&nbsp;
<a className="button button--info" onClick={() => SetLanguage('php')}>Php</a>&nbsp;
<a className="button button--danger" onClick={() => SetLanguage('go')}>Go</a>
<br/>
<br/>

In this section we present a workflow example to migrate a third party vendor configuration into a PANOS configuration. 
This code can be found at the following link:

<a href="https://conversionupdates.paloaltonetworks.com/expedition2/examples/workflows.zip">https://conversionupdates.paloaltonetworks.com/expedition2/examples/workflows.zip</a>   

### Step 1. Obtainig the API Keys

Refer to [Obtaining the API Keys section](creating_credentials.mdx) to obtain a valid API key stored in the ```hed``` variable.


### Step 2. Creating an Expedition project    
In the large amount of automation cases, we will require having an Expedition project. Making a POST call to the projects route, we can create a project with a desired name.
By default, the creator of a project is as well one of the project administrators.
Notice that this time we attach the credentials ```hed``` in the CURL headers to present our credentials and verify we have permission to create a project.  

API syntax for creating a new project:  

| Method      | EndPoint                                     | Parameters                     | 
|-------------|----------------------------------------------|--------------------------------|
|    POST     | <small>`https://<ExpIP>/api/v1/projects`</small> | <small>_in url_<br/>{ **"project"**:"project1", **"description"**:"Project for testing" }</small> |  
|    example  | <small>`https://10.0.01/api/v1/projects`</small> | <small>{"project":"MyLittleProject", "description":"A migration project"}</small>           | 

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('CREATE NEW PROJECT')
data = {"project":projectName}
r = requests.post('https://'+ip+'/api/v1/projects', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    #print('New project created successfully')
    projectId = json.dumps(response['Contents']['response']['data']['content']['id'])
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')
```
</TabItem> 
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
<TabItem value="php"> 

```php

echo "\n";
echo "CREATE NEW PROJECT\n";
$data = ["project"=> $projectName];
$url = 'https://'.$ip.'/api/v1/projects';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;
if ($success=='true'){
    print_r($response);
    $projectId = $jsonResponse->Contents->response->data->content->id;
    print_r($jsonResponse->Contents->response->{'response-messages'}->messages[0]->message);
}
echo "\n";
```  
</TabItem>
</Tabs>  

### Step 3. Upload the 3rd party vendor (source) configuration into Expedition  
The migration process would require to upload one of more configuration files to be migrated. 
A minimum one would be the original vendor configuration file, and we plan to support bringing also routing table files 
to support dynamic routing tables which values are not specified in the firewall configuration.

For example, you can upload the cisco configration "_cisco.asa.txt_" within the folder:  
```console
/var/www/html/expedition-api/contents/configSamples/CiscoCase/ 
``` 

This folder should be reachable by the `www-data` user and its content should be readable by the user as well.

### Step 4. Converting the source configuration to a PAN-OS configuration 
The migration process takes one compressed ZIP file that encapsulates the file(s) from the original vendor(s) to be migrated,
a base configuration where the migration will be inserted and a mapping file that provides instructions to determine
where each configuration needs to be placed. For instance, this file will state whether we want a Fortinet policy to become a
specific Device Group in a Panorama configuration, if we desire a specific routes file to be used for routing and zones calculations
for a specific original configuration or if we desire some remapings to take place for specific networks or interfaces. 

Supported vendors are Checkpoint, Cisco (ASA), Fortinet (Fortigate) and Juniper (Junos). <br/>
Coming vendors, Cisco (Switch, ISR), Junper (Netscreen), PFSense, Sonicwall, Sophos. 
  
Refer to [Creating a migration ZIP file](creating_migration_zip) to obtain specific information on how to construct a ```ZIP file``` with the migration contents. 

API syntax for Converting 3rd party vendors' configurations:  

| Method      | URL                                                        | Parameters |
|-------------|-----------------------------------------------------------------|------------|
|       POST  | <small>`https://<ExpIP>/api/v1/migration/convert`</small>  | <small>_in body_<br/>{**"input"**: "path to the ZIP file",<br/>**"output"**: "path to the resulting PANOS config file",<br/>(optional) **dry-run**: boolean}</small>|
|    example  | <small>`https://10.0.0.1/api/v1/migration/convert`</small> | <small>_in body_<br/>{"input": "/var/www/html/expedition-api/contents/configSamples/migration1.zip",<br/>"output":"/tmp/convertedConfig.xml",<br/> dry-run: true }</small>|


In the case we have already imported a PAN-OS device into Expedition, it is also possible to provide that device’s identification to use the devices configuration as a base config on which to make the conversion.  

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('CONVERT FORTINET CONFIGURATION TO PALO ALTO')
data = {"file":originalConfigPath,"out":panosConfigPath,"vendor":vendor, "serial":serial}
print(data)
r = requests.post('https://'+ip+'/api/v1/external-tools/convert', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    #print('Config converted successfully')
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')
```
</TabItem> 
<TabItem value="php"> 

```php
echo "\n";
echo "CONVERT CISCO CONFIGURATION TO PALO ALTO\n";

$originalConfigFolderPath="/var/www/html/expedition-api/contents/configSamples/CiscoCase/";
$panosConfigPath="/tmp/cisco.xml";
$vendor="ciscoasa";

$data = ["folder"=>$originalConfigFolderPath, "out"=>$panosConfigPath, "vendor"=>$vendor];
$url = 'https://'.$ip.'/api/v1/external-tools/convert';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);

$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;

if ($success=='true'){
    print_r($jsonResponse->Contents->response->{'response-messages'}->messages[0]->message);
}
```  
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs>  

### Step 5. Importing the configuration into the Project  
Once the conversion has done, we can import the resulting XML config file into an existing project for later configuration manipulations, such as delete unused objects, rename zones, etc.  
The Snippet below shows how to import the converted configuration into a project. 

API syntax for Importing the PAN-OS Configuration into the project:  

| Method      | EndPoint                                   | Parameters | 
|-------------|--------------------------------------------|------------|
|       POST  | <small>`https://<ExpIP>/api/v1/projects/{projectId}/importConfig`</small> | <small>_in url_<br/>**"project"**: "projectID"<br/><br/>_in body_<br/>{**"config"**: "Panos Config file " }</small>|
| example     | <small>`https://10.0.0.1/api/v1/projects/1/importConfig`</small>         | <small>_in url_<br/>project=1<br/><br/>_in body_<br/>{"config": "/tmp/convertedConfig.xml" }</small> |

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('IMPORT CONFIGURATION')
data = {"config":panosConfigPath}
r = requests.post('https://'+ip+'/api/v1/projects/'+projectId+'importConfig', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    print('Config imported successfully')
    #print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')
```
</TabItem> 
<TabItem value="php">

```php
echo "\n";
echo "IMPORT CONFIGURATION\n";
$data = ["config" => $panosConfigPath];
$url = 'https://'.$ip.'/api/v1/projects/'.$projectId.'/importConfig';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);

$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;

if ($success=='true'){
    echo 'Config imported successfully';
}
```
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs>  

## Assign PAN-OS Device to the Expdition project  
If we want to interact with a device for being able to retrieve it’s configuration, push a new configuration or learn from the traffic logs that the device has generated (this feature will come in future releases), we need to declare a PANOS Device in Expedition.  

### Step 1. Add a PAN-OS device (Firewall or Panorama)  
The first action is to generate an API call to Expedition to declare the new device. 
Some initial information regarding the device is necessary, including the serial number, device name, IP address or hostname to be able to reach the device and the device model.  

 

API syntax for adding a PAN-OS device into the project:  

| Method | EndPoint                                   | Parameters | 
|-------------|--------------------------------------------|------------|
|    POST     | <small>`https://<ExpIP>/api/v1/devices`</small> |  <small>_in_body_<br/>{**"serial"**: "serial#ofyourFW",<br/>**"device_name"**: "a name",<br/> **"hostname"**: "device IP", <br/>**"type"**:"model"}</small> |  
|    example  | <small>`https://10.0.0.1/api/v1/devices`</small> |  <small>_in body_<br/>{"serial": "01232212",<br/>"device_name": "myFW2",<br/> "hostname": "10.0.0.2", <br/>"type":"pa220"}</small> |  


The API response will provide us an internal Expedition identifier for the newly generated device. 

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('CREATE NEW DEVICE')
data = {
	"device_name": device_name,
	"serial": serial,
	"hostname": hostname,
	"vsys": vsys,
	"type": type
}
r = requests.post('https://'+ip+'/api/v1/devices', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    deviceId = json.dumps(response['Contents']['response']['data']['content']['id'])

    #print('New device created successfully')
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message'][0]))
print('')  
```  
</TabItem> 
<TabItem value="php">

```php
echo "CREATE NEW DEVICE\n";
$data = array(
	"device_name"   => $device_name,
	"serial"        => $serial,
	"hostname"      => $hostname,
	"type"          => $type
);
$url = 'https://'.$ip.'/api/v1/devices';
print_r($data);
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER,TRUE);
curl_setopt($curl, CURLOPT_POST,TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST,FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER,FALSE);

$response = curl_exec($curl);
$info = curl_getinfo($curl);
//print_r($info);
curl_close($curl);
//echo $response;
$jsonResponse = json_decode($response);
//print_r($jsonResponse);
$success = $jsonResponse->Contents->success;
if ($success=='true'){
    $deviceId = $jsonResponse->Contents->response->data->content->id;
    print('New device created successfully');
    #print_r($jsonResponse->Contents->response->{'response-messages'} ->messages[0]->details->causes 
            ->description);
}
```  
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs> 

### Step 2. Retrieve Device API Keys  
Once the device is created, if we need to retrieve its content or make future configuration pushes to the device, it will be necessary to have a device API Key.  

API syntax for retrieve PAN-OS device API key:  

| Method | EndPoint                                   | Parameters | 
|-------------|--------------------------------------------|------------|
|       POST     | <small>`https://<ExpIP>/api/v1/device/keys`</small> | <small>_in body_<br/>{**"id"**: "deviceID",<br/>**"role"**: "desired role",<br/> **"username"**: *"username in your PANOS device"*, <br/>**"password"**:*"password to access your device"*}</small> |  
|       POST     | <small>`https://10.0.0.1/api/v1/device/keys`</small> | <small>_in body_<br/>{"id": "deviceID",<br/>"role": "personal",<br/>"username":"didac",<br/>"password":"kuerti"}</small> |  

Notice that to be able to retrieve the API keys, we need to provide the login and password that we use to connect with the PANOS device.  

When creating and registering the API key, we should provide the role that can make use of it.  

There are 4 different options: **Admin, User, Viewer, Personal**.  
:::info
**.admin** (project related): all admin users in a given project will use this API key to interact with the device. In the device audit logs, there will be no unique identification of the user that has submitted the API calls to the device, as it could have been done by any of the project administrators.  

**.user** (project related): all users users in a given project will use this API key to interact with the device. In the device audit logs, there will be no unique identification of the user that has submitted the API calls to the device, as it could have been done by any of the project users.  

**.viewer** (project related): all viewer users in a given project will use this API key to interact with the device. In the device audit logs, there will be no unique identification of the user that has submitted the API calls to the device, as it could have been done by any of the project viewers.  

**.personal** (user related): this API key is private to the user that has requested it, and it will be used when this user requires interactions with the Panos Device. A benefit of this key is that in the device audit logs, the user will be identified as having sent the API calls to the device.  
:::  

The following snippet shows how to consume the Expedition API to retrieve PAN-OS Device API keys and register these API keys into the defined device.  

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('ADD DEVICE KEYS')
data = {
	"id":deviceId,
	"role":device_roles,
	"auth_type":device_auth,
	"username":device_username,
	"password":device_pwd
}
r = requests.post('https://'+ip+'/api/v1/device/keys', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    #print('Device keys added')
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')
```
</TabItem> 
<TabItem value="php">  

```php
echo "\n";
echo "ADD DEVICE KEYS\n";

$device_roles = 'personal';

$data = [
	"id" => $deviceId,
	"role" => $device_roles,
	"auth_type" => $device_auth,
	"username" => $device_username,
	"password" => $device_pwd
];
$url = 'https://'.$ip.'/api/v1/device/keys';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);
print_r($response);
$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;
if ($success=='true'){
    #print('Device keys added')
    print_r($jsonResponse->Contents->response->{'response-messages'}->messages[0]->message);
}
```  
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs>

### Step 3. Retrieve Device’s content  

We can retrieve the config from a device by specify the value either **`candidate`** or **`running`** in the **{config}** parameter when consuming API call.

API syntax for retrieve PAN-OS device contents:  

| Method      | EndPoint                                                                                   | Parameters                                                              | 
|-------------|--------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|     GET     | <small>`https://<ExpIP>/api/v1/device/{deviceId}/retrieveContent/{config}`</small>  | <small>**"deviceID"**-> PAN-OS device ID,<br/>**"config"**-> "running"or "candidate"</small> |   
|    example  | <small>`https://10.0.0.1/api/v1/device/1/retrieveContent/running`</small>        | <small>_in url_<br/>deviceID=1,<br/>config=candidate</small> |

This is a task that, depending on the configuration size and the connection speed with the Panos Device, may take a reasonable amount of time.  

Therefore, this task (as several other tasks that require long processing time) is executed as a background task so it does not block the whole script execution.  

So, the API call will respond with a job identified **`jobId`** that can be checked to identify when the assigned task is completed.  

In the second part of the code, we present one approach to monitor the execution state of the download config process, which is informed in the status element within the JSON content response. 

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python  
print('RETRIEVE DEVICE CONTENT')
r = requests.get('https://'+ip+'/api/v1/device/'+deviceId+'/retrieveContent/candidate', verify=False, headers=hed)
response=r.json()
jobId = json.dumps(response['Contents']['response']['data']['content']['jobId'])
print('Job id: '+jobId)
#print(json.dumps(response['Contents']['response']['response-messages']['messages']))
print('')  

print('CHECK IF DEVICE CONTENT IS DOWNLOADED')
r = requests.get('https://'+ip+'/api/v1/job/status/'+jobId, verify=False, headers=hed)
response=r.json()
jobState = json.dumps(response['Contents']['response']['data']['content']['msg']['state'])
percentage = float(jobState) * 100
print('Retrieving content from device: '+ str(percentage)+ '%')

#Wait until all content is retrieved from device
while(jobState != '1'):
    sleep(5)
    r = requests.get('https://'+ip+'/api/v1/job/status/'+jobId, verify=False,headers=hed)
    response = r.json()
    jobState = json.dumps(response['Contents']['response']['data']['content']['msg']['state'])
    percentage = float(jobState)*100
    print('Retrieving content from device: '+ str(round(percentage,2))+ '%')
    
print('')  
```  
</TabItem> 
<TabItem value="php">   

```php
echo "RETRIEVE DEVICE CONTENT\n";

$configType = "candidate";

$url = 'https://'.$ip.'/api/v1/device/'.$deviceId.'/retrieveContent/'.$configType;
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$jobId = $jsonResponse->Contents->response->data->content->jobId;
echo ('Job id: '.$jobId);
#print(json.dumps(response['Contents']['response']['response-messages']['messages']))

// ------
// Other tasks can be performed here while the configuration is being downloaded
// ------

echo "\n";
echo "CHECK IF DEVICE CONTENT IS DOWNLOADED\n";
$url = 'https://'.$ip.'/api/v1/job/status/'.$jobId;
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$jobState = $jsonResponse->Contents->response->data->content->msg->state;
$percentage = (float)$jobState * 100;
echo ('Retrieving content from device: '. (string)$percentage. '%');
echo "\n";

#Wait until all content is retrieved from device
while($jobState != '1'){
    sleep(5);
    $response = curl_exec($curl);
    $jsonResponse = json_decode($response);
    $jobState = $jsonResponse->Contents->response->data->content->msg->state;
    $percentage = (float)$jobState * 100;
    echo ('Retrieving content from device: '. (string)round($percentage). '%');
    echo "\n";
}
```
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs> 

### Step 4. Attach device to the Expedition Project

While a configuration is being downloaded, for instance, it would be possible to attach the device to an existing project, so we have the chance to import the device configuration into the project or so we can send the resulting project configuration back to the device.  

API syntax for attach device to the Expedition project:  

| Method | EndPoint                                                          | Parameters                                                              | 
|-------------|--------------------------------------------------------------|-------------------------------------------------------------------------|
|     PUT     | <small>`https://<YourExpeditionIP>/api/v1/projects/`</small> | <small>_in body_<br/>{**"devices"**:["deviceID1", "deviceID2"], <br/>**"id"**:"projectID"}</small> |  
|     example |  <small>`https://10.0.0.1/api/v1/projects/`</small>          |  <small><br/>{"devices": [1],<br/>"id": 1}</small>|

In the snippet below, we show how the device created above which id we prior stored in the **`deviceId`** variable, is attached to the newly created project.
This call is making a modification on the project settings, therefore we are sending a PUT request to the project route.  
<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('ASSIGN DEVICE TO PROJECT')
data = {"devices":[deviceId],"id":projectId}
r = requests.put('https://'+ip+'/api/v1/projects', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    #print('Device assigned to project')
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')
```
</TabItem> 
<TabItem value="php"> 

```php
echo "ASSIGN DEVICE TO PROJECT\n";
$data = ["devices"=>[$deviceId],
        "id"=>$projectId];

$url = 'https://'.$ip.'/api/v1/projects';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl, CURLOPT_CUSTOMREQUEST, "PUT");
curl_setopt($curl,CURLOPT_POSTFIELDS, http_build_query($data));
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);

$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;

if ($success=='true'){
    print_r($jsonResponse->Contents->response->{'response-messages'}->messages[0]->message);
}
```
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs>

## Push configuration to a PAN-OS device  
Pushing a project configuration to a device requires having a project created, a device declared and having credentials (Device API keys) to interact with such device.  
Once we have those, what would remain is the generation of the different API calls to a PANOS device that will receive the configuration, and executing those calls to apply the changes on the device’s candidate configuration. 

### Step 1. Generating PAN-OS API calls  
Once we have a project completed and we desire to submit all or part of the configuration to a PANOS device, we will have to generate the API calls.
We can create **mega, atomic, subatomic and clear** API calls.  
:::info  
**mega**: generates one single API call containing the complete XML configuration.  

**atomic**: would generate one API call for each section in the configuration, such as address objects section, service object section, etc. In case of multiple DGs, we may obtain one API call for each section in the DG.  

**subatomic**: would generate an API call for every element in a configuration. For instance, one API call for each address object in a configuration. This may be required when only certain objects should be submitted to the device.  

**clear**: would generate API calls to delete the content of the desired section  
:::  

API syntax for generating PAN-OS API calls:  

| Method | EndPoint                                                                                    | Parameters                                                              | 
|-------------|----------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|     POST    | <small>`https://<YourExpeditionIP>/api/v1/projects/{projectId}/apiCalls/{type}`</small>| <small>_in url_<br/>**"projectId"**-> Expedition Project ID,<br/>**"type"**-> "mega" or "atomic" or "subatomic" or "clear"<br/><br/> _in body_<br/>{**"serial"**: serial#ofyourFW",<br/>**"role"**: "admin",<br/>**"auth_type"**: "UserPassword",<br/>**"username"**: *"YourPAN-OSdeviceLoginusername"*,<br/>**"password"**: *"YourPAN-OSdeviceLoginpassword"*,<br/>**"sourceId"**: 0,<br/>**"action"**: "set"<br/>}</small> |  
|     example | <small>`https://<YourExpeditionIP>/api/v1/projects/1/apiCalls/atomic`</small>          | <small>{"serial": 012123212,<br/>"role":"admin",<br/>"auth_type":"UserPassword",<br/>"username":"YourPAN-OSdeviceLoginusername",<br/>"password":"YourPAN-OSdeviceLoginpassword",<br/>"sourceId":0,<br/>"action":"set"<br/>}</small> |  

The response will provide us a list of the generated API calls with their corresponding ids and types and order of execution.  

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
print('PUSH CONFIG TO DEVICE')
data = {"source":source}
r = requests.post('https://'+ip+'/api/v1/projects/'+projectId+'apiCalls/atomic', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    #print('Api calls created')
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')
```
</TabItem> 
<TabItem value="php"> 

```php
echo "\n";
echo "PUSH CONFIG TO DEVICE\n";
$data = [
    "sourceId"=>$source
  ];
$url = 'https://'.$ip.'/api/v1/projects/'.$projectId.'/apiCalls/atomic';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;

if ($success=='true'){
    print_r($jsonResponse->Contents->response->{'response-messages'}->messages[0]->message);
}
```
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs>  

### Step 2. Sending API calls to the PAN-OS Device 
Once generated the API calls, we can submit them to a device, either a Firewall or a Panorama. We can provide the device identification via its serial number. In the case a device is managed by a Panorama, this will be used as a proxy to submit the API calls.
The Device API key that we have assigned will be used for the submission of the calls. If a personal API key has been registered in Expedition, this will take precedence over an admin/user/viewer API key.  

API syntax for sending APIcalls to the PAN-OS Device:  

 Method       | EndPoint                                                                              | Parameters                                                              | 
|-------------|---------------------------------------------------------------------------------------|-------------------------------------------------------------------------|-----------------------------------------|
|     POST    | <small>`https://<YourExpeditionIP>/api/v1/projects/{projectId}/device/push`</small>   | <small>_in url_<br/>**"projectId"**-> Expedition Project ID<br/><br/>_in body_<br/>{**"serial"**: serial#ofyourFW",<br/>**"source"**: PAN-OSconfigfile<br/>}</small> | 
|     example | <small>`https://<YourExpeditionIP>/api/v1/projects/1/device/push`</small>             | <small>_in url_<br/>"projectId"= 1<br/><br/>_in body_<br/>{"serial": 01213221,<br/>"source":1<br/>}</small> | 


When submitting the API calls, we can enumerate those ones that we want to submit or, if none is specified, all the generated API calls will be submitted to the device in the order of execution.  

Submitting the API calls is executed as a set of tasks in a job. We can monitor the status of the tasks by checking the job status. Once the process is complete, we can request the result of the execution by checking the complete information of the job.  

For instance, in the below snippet, we request information regarding possible errors faced during the submission of the API calls.  

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  
<TabItem value="python">  

```python
data = {"serial":serial,"source":source}
r = requests.post('https://'+ip+'/api/v1/projects/'+projectID+'/device/push', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    print('Sending api calls')
    print('')
jobId = json.dumps(response['Contents']['response']['data']['content']['jobId'])

print('API CALLS STATUS')
r = requests.get('https://'+ip+'/api/v1/job/status/'+jobId, verify=False, headers=hed)
response=r.json()
jobState = json.dumps(response['Contents']['response']['data']['content']['msg']['state'])
percentage = float(jobState)*100
print('Pushing config to device: '+ str(round(percentage,2))+ '%')

#Wait until all content is retrieved from device
while(jobState != '1'):
    sleep(5)
    r = requests.get('https://'+ip+'/api/v1/job/status/'+jobId, verify=False,headers=hed)
    response = r.json()
    jobState = json.dumps(response['Contents']['response']['data']['content']['msg']['state'])
    percentage = float(jobState)*100
    print('Pushing config device: '+ str(round(percentage,2))+ '%')

r = requests.get('https://'+ip+'/api/v1/job/status/'+jobId+'/complete', verify=False, headers=hed)
response=r.json()
jobState = json.dumps(response['Contents']['response']['data']['content']['msg']['state'])
taskCode = json.dumps(response['Contents']['response']['data']['content']['msg']['TasksMsg'][0]['statusCode'])
if (int(taskCode)==-1):
	taskStatus = json.dumps(response['Contents']['response']['data']['content']['msg']['TasksMsg'][0]['statusMessage'])
	taskMessage = json.dumps(response['Contents']['response']['data']['content']['msg']['TasksMsg'][0]['resultCode'])
print('Config pushed successfully')
```  
</TabItem> 
<TabItem value="php"> 

```php
$data = [
     "serial"=>$serial, 
     "source"=>$source
   ];
$url = 'https://'.$ip.'/api/v1/projects/'.$projectId.'/device/push';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;
if ($success=='true'){
    echo 'Sending api calls';
}
$jobId = $jsonResponse->Contents->response->data->content->jobId;

echo "\n";
echo "API CALLS STATUS\n";
$url = 'https://'.$ip.'/api/v1/job/status/'.$jobId;
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$jobState = $jsonResponse->Contents->response->data->content->msg->state;
$percentage = (float)$jobState * 100;
echo "\n";
echo ('Pushing config to device: '. (string)round($percentage) . '%');

#Wait until all content is retrieved from device
while($jobState != '1'){
    sleep(5);
    $response = curl_exec($curl);
    $jsonResponse = json_decode($response);
    $jobState = $jsonResponse->Contents->response->data->content->msg->state;
    $percentage = (float)$jobState * 100;
    echo "\n";
    echo ('Pushing config to device: '. (string)round($percentage) . '%');
}


if($percentage == ‘100’)
   echo 'Config pushed successfully';
else
   echo 'There have been errors submitting the API calls';

$url = "https://'.$ip.'/api/v1/job/status/'.$jobId.'/complete\n";
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl, CURLOPT_HEADER, 0);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
print_r($jsonResponse);

$callResultErrors = $jsonResponse->Contents->response->data->content->msg->errors;
echo "The following API errors have been encountered:";
print_r($callResultErrors);
```  
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs> 

## Export PAN-OS configuration from Expedition  

Instead of making API calls from Expedition as stated in previous section, you can export the PAN-OS configuration from Expedition and manually loaded the configuraiton back to PAN-OS device. 

The output file path needs to be writable by the www-data user, therefore we recommend to place those files in the project directory.  

API syntax for export PAN-OS configuration from Expedition:  

| Method | EndPoint                                                                       | Parameters                                                              |
|-------------|--------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|     POST    | <small>`https://<ExpIP>/api/v1/projects/{projectId}/export`</small> | <small>_in url_<br/>{**"projectId"**->"$projectId"<br/><br/>_in body_<br/>{**"out:"**->PAN-OS configuration file,<br/>**"sourceID:"**->source configuration ID<br/>}</small> |  
|     POST    | <small>`https://10.0.0.1/api/v1/projects/1/export`</small> | <small>_in url_<br/>"projectId"=1<br/><br/>_in body_<br/>{"out:"->"toExport.xml",<br/>"sourceID:"1}</small> |  

<Tabs defaultValue={typeof window !== 'undefined' && localStorage.getItem('defaultLanguage') ? localStorage.getItem('defaultLanguage') : 'python'}
values={[
{ label: 'Python', value: 'python', },
{ label: 'Php', value: 'php', },
{ label: 'Go', value: 'go', },
]
}>  

<TabItem value="python">

```python

print('EXPORT API CALL AS XML') #you can use it to get the final xml and then upload it manually to the firewall
outPath = '/home/userSpace/projecs/fortinetDemo'
sourceId = 1 #you can get the source id with the sources given in the previous api call
data = {"out":outPath,"sourceId":sourceId}
r = requests.post('https://'+ip+'/api/v1/'+projectId+'/export', data=data, verify=False, headers=hed)
response=r.json()
success = json.dumps(response['Contents']['success'])
if success=='true':
    print(json.dumps(response['Contents']['response']['response-messages']['messages'][0]['message']))
print('')  

```  
</TabItem> 
<TabItem value="php">  

```php
$data = [
     "sourceId"=>$source, 
     "out"=>"/home/userSpace/projects/$projectId/panos.xml"
   ];
$url = 'https://'.$ip.'/api/v1/projects/'.$projectId.'/export';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl,CURLOPT_POST, TRUE);
curl_setopt($curl,CURLOPT_POSTFIELDS, $data);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$success = $jsonResponse->Contents->success;
if ($success=='true'){
    echo 'Configuration export process initiated;
}
$jobId = $jsonResponse->Contents->response->data->content->jobId;

echo "\n";
echo "Export Status\n";
$url = 'https://'.$ip.'/api/v1/job/status/'.$jobId;
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, FALSE);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
$jobState = $jsonResponse->Contents->response->data->content->msg->state;
$percentage = (float)$jobState * 100;
echo "\n";
echo ('Configuration exported to '. (string)round($percentage) . '%');

#Wait until all content is retrieved from device
while($jobState != '1'){
    sleep(5);
    $response = curl_exec($curl);
    $jsonResponse = json_decode($response);
    $jobState = $jsonResponse->Contents->response->data->content->msg->state;
    $percentage = (float)$jobState * 100;
    echo "\n";
    echo ('Configuration exported to '. (string)round($percentage) . '%');
}
if($percentage == '100')
   echo 'Config exported successfully to path '.$out.'/n';
else
   echo 'There have been errors generating the XML output file';

$url = "https://'.$ip.'/api/v1/job/status/'.$jobId.'/complete\n";
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HTTPHEADER,$hed);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($curl, CURLOPT_HEADER, 0);
$response = curl_exec($curl);
$jsonResponse = json_decode($response);
print_r($jsonResponse);

$callResultErrors = $jsonResponse->Contents->response->data->content->msg->errors;
echo "The following errors have been encountered during Config generation:";
print_r($callResultErrors);
```  
</TabItem>
<TabItem value="go">  

```go
package main
import "fmt"

func main() {
    //TODO
}
```
</TabItem> 
</Tabs> 